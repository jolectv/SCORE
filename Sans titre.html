<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de Score Handball</title>
    <style>
        /* Re-import de la police numérique DSEG7 Classic */
        @import url('https://fonts.googleapis.com/css2?family=DSEG7+Classic&display=swap');

        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            background-color: transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            color: #e0e0e0;
            height: 100vh;
            overflow: hidden;
            padding: 10px;
            box-sizing: border-box;
        }

        :root {
            --scoreboard-bg-color-start: rgba(30, 30, 30, 0.95);
            --scoreboard-bg-color-end: rgba(15, 15, 15, 0.95);
            --team-logo-glow-color: rgba(255, 255, 255, 0.5);

            /* NOUVEAU: Variables pour la position et la taille des logos */
            --logo-pos-x-team1: -50%;
            --logo-pos-y-team1: -50%;
            --logo-scale-team1: 1;
            --logo-pos-x-team2: -50%;
            --logo-pos-y-team2: -50%;
            --logo-scale-team2: 1;
        }

        .top-scoreboard-display {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px 15px;
            background: linear-gradient(145deg, var(--scoreboard-bg-color-start), var(--scoreboard-bg-color-end));
            border: 2px solid #555555;
            border-radius: 5px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.8), inset 0 0 10px rgba(255, 255, 255, 0.05);
            box-sizing: border-box;
            gap: 15px;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }

        .top-scoreboard-display.transparent-style {
            background: none;
            border: none;
            box-shadow: none;
        }

        .exclusion-display-row {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            margin-top: -10px;
            gap: 15px;
            flex-shrink: 0;
            box-sizing: border-box;
            padding: 0 15px;
            width: auto;
        }

        .exclusion-spacer {
            width: 130px;
            flex-shrink: 0;
            height: 10px;
        }

        .team-exclusions-container {
            display: flex;
            flex-wrap: wrap;
            align-items: flex-start;
            padding: 3px;
            min-height: 30px;
            gap: 4px;
            flex-grow: 0;
            flex-shrink: 0;
            width: 250px;
            box-sizing: border-box;
            position: relative;
        }

        .team1-exclusions {
            justify-content: flex-start;
        }

        .team2-exclusions {
            justify-content: flex-end;
        }

        /* Style pour chaque exclusion individuelle */
        .exclusion-timer {
            background-color: #cc0000;
            color: white;
            font-family: 'DSEG7 Classic', monospace;
            /* Applique DSEG7 Classic */
            font-size: 0.9em;
            /* Ajusté pour la nouvelle police */
            padding: 2px 5px;
            border-radius: 3px;
            min-width: 40px;
            text-align: center;
            box-shadow: 0 0 6px rgba(255, 50, 50, 0.7);
            animation: pulse-strong 1s infinite alternate;
        }

        @keyframes pulse-strong {
            from {
                opacity: 1;
                transform: scale(1);
                box-shadow: 0 0 8px rgba(255, 50, 50, 0.7);
            }

            to {
                opacity: 0.8;
                transform: scale(1.05);
                box-shadow: 0 0 15px rgba(255, 50, 50, 0.9);
            }
        }

        .timeout-message {
            background-color: #0056b3;
            color: white;
            font-weight: bold;
            font-size: 1.1em;
            padding: 5px 10px;
            border-radius: 6px;
            text-align: center;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            box-shadow: 0 0 10px rgba(0, 123, 255, 0.8);
            z-index: 10;
        }

        @keyframes fadeOut {
            0% {
                opacity: 1;
            }

            80% {
                opacity: 1;
            }

            100% {
                opacity: 0;
                display: none;
            }
        }

        .bottom-controls-row {
            display: flex;
            justify-content: space-around;
            align-items: flex-start;
            width: 100%;
            max-width: 1200px;
            margin-top: 15px;
            gap: 20px;
            box-sizing: border-box;
            flex-grow: 1;
            overflow-y: auto;
            padding-bottom: 10px;
        }

        .controls-block {
            flex: 1;
            min-width: 320px;
            padding: 15px;
            background-color: #2b2b2b;
            border: 2px solid #444444;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            text-align: left;
            box-sizing: border-box;
        }

        .controls-block h3 {
            margin-top: 0;
            color: #f0f0f0;
            border-bottom: 1px solid #555555;
            padding-bottom: 8px;
            margin-bottom: 12px;
            font-size: 1.1em;
            text-align: center;
        }

        .control-group {
            margin-bottom: 10px;
        }

        .control-group label {
            display: block;
            margin-right: 0;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 0.9em;
            color: #bbbbbb;
            text-align: center;
        }

        .centered-content-group {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            width: 100%;
            gap: 10px;
            box-sizing: border-box;
        }

        .control-group input[type="text"],
        .control-group input[type="file"],
        .control-group select {
            width: auto;
            padding: 6px;
            margin-top: 3px;
            margin-left: auto;
            margin-right: auto;
            border: 1px solid #555;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 0.9em;
            background-color: #444;
            color: #f0f0f0;
            display: block;
        }

        .control-group input[type="checkbox"] {
            width: auto;
            margin-top: 5px;
            margin-left: 0;
            margin-right: 0;
            cursor: pointer;
            display: inline-block;
        }

        .control-group button {
            padding: 6px 12px;
            margin: 3px 0;
            font-size: 14px;
            cursor: pointer;
            background-color: #0088cc;
            color: white;
            border: none;
            border-radius: 44px;
            transition: background-color 0.2s ease;
        }

        .control-group button:hover {
            background-color: #006699;
        }

        .score-button {
            padding: 10px 20px !important;
            font-size: 20px !important;
            font-weight: bold;
            background-color: #28a745;
        }

        .score-button:last-child {
            background-color: #dc3545;
        }

        .score-button:hover {
            opacity: 0.9;
        }

        .remove-button-red {
            background-color: #dc3545 !important;
        }

        .remove-button-red:hover {
            background-color: #c82333 !important;
        }

        /* Styles pour le cadre du logo */
        .team-score-container .team-info .logo {
            flex-shrink: 0;
            transition: all 0.3s ease;
            box-sizing: border-box;
            /* S'assure que la bordure n'augmente pas la taille totale */

            width: 40px;
            /* Largeur du cadre visible (2/3 de la hauteur) */
            height: 60px;
            /* Hauteur du cadre visible */
            overflow: hidden;
            /* Cache les parties débordantes du logo grossi */
            position: relative;
            /* Nécessaire pour le positionnement absolu de l'image à l'intérieur */
            border-radius: 5px;
            /* Optionnel: ajoute une légère courbure au cadre */
        }

        /* Spécifique pour le logo de l'équipe 1 (qui est à gauche du nom) */
        .team1 .team-info .logo {
            margin-right: 8px;
            /* Marge à droite pour séparer du nom */
            margin-left: 0;
            /* Assure qu'il n'y a pas de marge gauche non voulue */
            border: 1px solid var(--team1-color);
            /* Bordure de la couleur de l'équipe 1 */
            box-shadow: 0 0 5px var(--team1-color, #ff5733);
            /* Ajout d'une ombre assortie */
        }

        /* Spécifique pour le logo de l'équipe 2 (qui est à droite du nom) */
        .team2 .team-info .logo {
            margin-left: 8px;
            /* Marge à gauche pour le séparer du nom */
            margin-right: 0;
            /* Assure qu'il n'y a pas de marge droite non voulue */
            border: 1px solid var(--team2-color);
            /* Bordure de la couleur de l'équipe 2 */
            box-shadow: 0 0 5px var(--team2-color, #33a1ff);
            /* Ajout d'une ombre assortie */
        }

        /* Styles pour l'image du logo à l'intérieur du cadre */
        .team-score-container .team-info .logo img {
            position: absolute;
            top: 50%;
            /* Centre l'image verticalement */
            left: 50%;
            /* Centre l'image horizontalement */
            /* Utilise les variables CSS spécifiques à l'équipe */
            transform: translate(var(--logo-pos-x-team1), var(--logo-pos-y-team1)) scale(var(--logo-scale-team1));
            width: auto;
            height: auto;
            max-width: none;
            max-height: none;
        }

        /* Dupliquez et ajustez pour l'équipe 2 */
        .team2 .team-info .logo img {
            transform: translate(var(--logo-pos-x-team2), var(--logo-pos-y-team2)) scale(var(--logo-scale-team2));
        }

        /* Suppression des anciennes règles filter: drop-shadow pour éviter les conflits */
        /*
        .team1 .logo {
            filter: drop-shadow(0 0 5px var(--team1-color, #ff5733));
        }

        .team2 .logo {
            filter: drop-shadow(0 0 5px var(--team2-color, #33a1ff));
        }
        */

        .team-score-container {
            display: flex;
            align-items: center;
            background: linear-gradient(45deg, #1f1f1f, #333333);
            border-radius: 8px;
            padding: 5px 10px;
            /* NOUVEAU: Effet de relief avec ombres multiples */
            box-shadow:
                0 4px 8px rgba(0, 0, 0, 0.4),
                /* Ombre extérieure pour la profondeur */
                0 8px 16px rgba(0, 0, 0, 0.2),
                /* Ombre plus diffuse pour l'effet de "flottaison" */
                inset 0 0 10px rgba(255, 255, 255, 0.05),
                /* Lumière intérieure subtile */
                inset 0 0 20px rgba(0, 0, 0, 0.2);
            /* Ombre intérieure pour le creux */
            gap: 5px;
            flex-grow: 0;
            flex-shrink: 0;
            width: 250px;
        }

        .team-score-container.team1 {
            border-left: 6px solid var(--team1-color, #ff5733);
            justify-content: flex-start;
            /* NOUVEAU: Ombre plus prononcée pour l'effet de glow spécifique à l'équipe */
            box-shadow:
                0 0 15px rgba(255, 87, 51, 0.6),
                /* Lumière de glow extérieure */
                inset 0 0 15px rgba(255, 87, 51, 0.1),
                /* Lumière intérieure subtile */
                inset 0 0 8px rgba(0, 0, 0, 0.5);
            /* Ombre intérieure existante */
        }

        .team-score-container.team2 {
            border-right: 6px solid var(--team2-color, #33a1ff);
            justify-content: flex-end;
            /* NOUVEAU: Ombre plus prononcée pour l'effet de glow spécifique à l'équipe */
            box-shadow:
                0 0 15px rgba(51, 161, 255, 0.6),
                /* Lumière de glow extérieure */
                inset 0 0 15px rgba(51, 161, 255, 0.1),
                /* Lumière intérieure subtile */
                inset 0 0 8px rgba(0, 0, 0, 0.5);
            /* Ombre intérieure existante */
        }

        .team-info {
            display: flex;
            align-items: center;
        }

        .team-info .team-name {
            font-size: 1.6em;
            /* Adjust this to control initial width */
            font-weight: 700;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex-grow: 0;
            width: 120px;
            max-width: 120px;
            text-align: center;
            /* Increase height for the container to accommodate stretched text */
            line-height: 1;
            /* Reset line-height to 1 to avoid extra vertical space */
            height: 55px;
            /* Set a fixed height for the container, adjust as needed */
            display: flex;
            align-items: center;
            justify-content: center;

            /* Key for stretching characters vertically */
            transform: scaleY(1.5);
            /* Stretches vertically by 50% */
            transform-origin: center;
            /* Ensures stretching happens from the center */
        }

        .team-score-container .score {
            font-family: 'DSEG7 Classic', monospace;
            /* Police numérique */
            font-size: 3.5em;
            /* Taille pour un bon rendu */
            font-weight: bold;
            /* DSEG7 n'a pas vraiment de 'bold' */
            color: var(--score-color, #ffd700);
            margin: 0 8px;
            flex-shrink: 0;
            min-width: 60px;
            text-align: center;
            transition: transform 0.1s ease-out, color 0.1s ease-out;
            /* Très important pour éviter les chevauchements avec DSEG7 */
            letter-spacing: -2px;
            /* Ajuste l'espacement entre les caractères */
        }

        .timer-display-container {
            background-color: #1f1f1f;
            border-radius: 5px;
            padding: 5px 10px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-grow: 0;
            flex-shrink: 0;
            width: 130px;
            transition: background-color 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
            border: 2px solid #3a3a3a;
        }

        .timer-display-container #timer {
            font-family: 'DSEG7 Classic', monospace;
            /* Police numérique */
            font-size: 2.8em;
            /* Taille originale, réajustée pour DSEG7 */
            font-weight: bold;
            /* DSEG7 n'a pas vraiment de 'bold' */
            color: var(--timer-color, #ff0000);
            /* Très important pour DSEG7, ajuster si nécessaire */
            letter-spacing: -3px;
            /* Ajuste l'espacement pour que les chiffres ne se touchent pas trop */
        }

        .main-timer-display-row {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            flex-grow: 0;
        }

        .secondary-timer-display-row {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        #halfTimeDisplay {
            font-size: 0.9em;
            font-weight: bold;
            color: var(--half-time-color, #bbbbbb);
            margin-top: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
            /* Laissé sur une police standard, pas DSEG7 Classic */
            font-family: 'Arial', sans-serif;
        }

        .timer-paused-active {
            background-color: #3f0000;
            box-shadow: 0 0 15px rgba(255, 50, 50, 0.7), inset 0 0 10px rgba(255, 0, 0, 0.3);
            animation: pulse-border-bg 1.5s infinite alternate;
            border-color: #ff3333;
        }

        @keyframes blink-border {
            0% {
                border-color: #333333;
            }

            50% {
                border-color: #ff3333;
            }

            100% {
                border-color: #333333;
            }
        }

        @keyframes pulse-border-bg {
            0% {
                border-color: #ff3333;
                background-color: #3f0000;
            }

            100% {
                border-color: #ff9999;
                background-color: #5f0000;
            }
        }

        .secondary-team-display-row {
            display: none;
        }

        .timer-buttons-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            gap: 5px;
        }

        .timer-buttons-group button {
            flex-grow: 1;
            min-width: 60px;
            font-size: 14px;
        }

        #resetTimerButton {
            flex-grow: 0;
            width: auto;
            padding: 4px 8px;
            font-size: 12px;
            background-color: #dc3545;
            margin-left: auto;
        }

        #resetTimerButton:hover {
            background-color: #c82333;
        }

        .display-options-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 15px;
            padding-top: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .transparent-toggle-wrapper,
        .scoreboard-bg-color-wrapper,
        .color-picker-wrapper {
            display: flex;
            align-items: center;
            gap: 5px;
            flex-shrink: 0;
        }

        .scoreboard-bg-color-wrapper input[type="color"],
        .color-picker-wrapper input[type="color"] {
            width: 50px;
            height: 30px;
            padding: 0;
            border: 1px solid #666;
            background-color: #333;
            cursor: pointer;
            display: inline-block;
            margin: 0;
        }

        .scoreboard-bg-color-wrapper label,
        .color-picker-wrapper label {
            margin-bottom: 0;
            font-size: 0.8em;
            display: inline-block;
            text-align: left;
        }

        .color-picker-wrapper input[type="color"] {
            width: 40px;
            height: 25px;
        }

        .team-name-color-group {
            display: flex;
            align-items: center;
            gap: 5px;
            flex-wrap: nowrap;
            width: 100%;
        }

        .team-name-color-group input[type="text"] {
            flex-grow: 1;
            max-width: 80px;
            min-width: 60px;
            text-align: center;
            display: inline-block;
            margin: 0;
        }

        .team-name-color-group .color-picker-wrapper {
            flex-shrink: 0;
            margin-left: auto;
        }
    </style>
</head>

<body>
    <div class="top-scoreboard-display">
        <div class="team-score-container team1">
            <div class="team-info">
                <div class="logo">
                    <img src="logo1.png" alt="Logo Équipe 1" id="team1Logo">
                </div>
                <div class="team-name" id="team1NameDisplay">Équipe 1</div>
            </div>
            <div class="score" id="team1Score">0</div>
        </div>

        <div class="timer-display-container" id="timerContainer">
            <div class="main-timer-display-row">
                <span id="timer">00:00</span>
            </div>
            <div class="secondary-timer-display-row">
                <span id="halfTimeDisplay"></span>
            </div>
        </div>

        <div class="team-score-container team2">
            <div class="score" id="team2Score">0</div>
            <div class="team-info">
                <div class="team-name" id="team2NameDisplay">Équipe 2</div>
                <div class="logo">
                    <img src="logo2.png" alt="Logo Équipe 2" id="team2Logo">
                </div>
            </div>
        </div>
    </div>

    <div class="exclusion-display-row">
        <div class="team-exclusions-container team1-exclusions" id="team1ExclusionsContainer">
        </div>

        <div class="exclusion-spacer"></div>

        <div class="team-exclusions-container team2-exclusions" id="team2ExclusionsContainer">
        </div>
    </div>

    <div class="bottom-controls-row">
        <div class="controls-block">
            <div class="team-controls">
                <h3>Équipe 1 - Contrôles</h3>
                <div class="control-group">
                    <label for="team1LogoInput">Logo :</label>
                    <input type="file" id="team1LogoInput" accept="image/*" onchange="changeLogo(1)">
                </div>
                <div class="control-group">
                    <label>Ajuster Logo :</label>
                    <div class="centered-content-group" style="flex-direction: column; gap: 5px;">
                        <div style="display: flex; gap: 5px;">
                            <button onclick="adjustLogo(1, 'up')"
                                style="font-size: 1.2em; padding: 4px 8px;">↑</button>
                            <button onclick="adjustLogo(1, 'left')"
                                style="font-size: 1.2em; padding: 4px 8px;">←</button>
                            <button onclick="adjustLogo(1, 'right')"
                                style="font-size: 1.2em; padding: 4px 8px;">→</button>
                            <button onclick="adjustLogo(1, 'down')"
                                style="font-size: 1.2em; padding: 4px 8px;">↓</button>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button onclick="adjustLogo(1, 'plus')"
                                style="font-size: 1.2em; padding: 4px 8px;">+</button>
                            <button onclick="adjustLogo(1, 'minus')"
                                style="font-size: 1.2em; padding: 4px 8px;">-</button>
                        </div>
                    </div>
                </div>
                <div class="control-group" style="display: flex; align-items: center; gap: 15px;"> <label
                        for="team1Name">Nom :</label>
                    <input type="text" id="team1Name" value="Équipe 1" maxlength="7" onchange="updateTeamName(1)"
                        style="flex-grow: 1; max-width: 80px; text-align: center;">
                    <div class="color-picker-wrapper" style="flex-shrink: 0;">
                        <label for="team1Color" style="display: none;">Couleur:</label> <input type="color"
                            id="team1Color" onchange="updateTeamColor(1)" value="#ff5733"
                            style="width: 40px; height: 25px;">
                    </div>
                </div>
                <div class="control-group">
                    <label>Exclusions Temporaires :</label>
                    <div class="centered-content-group"> <button onclick="startExclusion(1)" data-shortcut="KeyW">+2
                            min</button>
                        <button class="remove-button-red" onclick="removeExclusion(1)" data-shortcut="KeyX">-2
                            min</button>
                    </div>
                </div>
                <div class="control-group">
                    <label>Temps Morts : <span id="team1TimeoutsControlDisplay"
                            style="font-weight: normal; color: #f0f0f0;">(0/3)</span></label>
                    <div class="centered-content-group"> <button onclick="addTimeout(1)"
                            data-shortcut="KeyE">+1</button>
                        <button class="remove-button-red" onclick="removeTimeout(1)" data-shortcut="KeyC">-1</button>
                    </div>
                </div>
                <div class="control-group">
                    <label>Score :</label>
                    <div class="centered-content-group"> <button class="score-button" onclick="updateScore(1, 1)"
                            data-shortcut="KeyQ">+1</button>
                        <button class="score-button" onclick="updateScore(1, -1)" data-shortcut="KeyA">-1</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="controls-block">
            <div class="timer-controls">
                <h3>Contrôles du Chrono</h3>
                <div class="control-group">
                    <label for="halfTime">Mi-temps :</label>
                    <select id="halfTime">
                        <option value="first">Première mi-temps</option>
                        <option value="second">Deuxième mi-temps</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Gestion du temps :</label>
                    <div class="timer-buttons-group centered-content-group"> <button onclick="startTimer()"
                            data-shortcut="Space">Démarrer</button>
                        <button onclick="stopTimer()" data-shortcut="KeyS">Stopper</button>
                        <button onclick="confirmResetTimer()" data-shortcut="KeyR" id="resetTimerButton">Reset
                            Chrono</button>
                    </div>
                </div>
                <div class="control-group">
                    <label>Ajuster le temps :</label>
                    <div class="centered-content-group"> <button onclick="adjustTimer(1)" data-shortcut="NumpadAdd"
                            id="adjustTimePlus1s">+1s</button>
                        <button onclick="adjustTimer(10)" data-shortcut="Digit1" id="adjustTimePlus10s">+10s</button>
                        <button onclick="adjustTimer(60)" data-shortcut="Digit2" id="adjustTimePlus1m">+1mn</button>
                        <button class="remove-button-red" onclick="adjustTimer(-1)" data-shortcut="NumpadSubtract"
                            id="adjustTimeMinus1s">-1s</button>
                        <button class="remove-button-red" onclick="adjustTimer(-10)" data-shortcut="Digit3"
                            id="adjustTimeMinus10s">-10s</button>
                        <button class="remove-button-red" onclick="adjustTimer(-60)" data-shortcut="Digit4"
                            id="adjustTimeMinus1m">-1mn</button>
                    </div>
                </div>
            </div>

            <div class="color-controls" style="margin-top: 20px; border-top: 1px solid #555555; padding-top: 15px;">
                <h3>Couleurs d'Affichage</h3>
                <div class="control-group display-options-group">
                    <div class="color-picker-wrapper">
                        <label for="scoreColor">Score :</label>
                        <input type="color" id="scoreColor" value="#ffd700" onchange="updateDisplayColors()">
                    </div>
                    <div class="color-picker-wrapper">
                        <label for="timerColor">Chrono :</label>
                        <input type="color" id="timerColor" value="#ff0000" onchange="updateDisplayColors()">
                    </div>
                    <div class="color-picker-wrapper">
                        <label for="halfTimeColor">Mi-temps :</label>
                        <input type="color" id="halfTimeColor" value="#aaaaaa" onchange="updateDisplayColors()">
                    </div>
                    <div class="transparent-toggle-wrapper">
                        <label for="transparentDisplayToggle">Transparent :</label>
                        <input type="checkbox" id="transparentDisplayToggle" onchange="toggleScoreboardStyle()">
                    </div>
                    <div class="scoreboard-bg-color-wrapper">
                        <label for="scoreboardBgColor">Fond :</label>
                        <input type="color" id="scoreboardBgColor" value="#1E1E1E"
                            onchange="updateScoreboardBackgroundColor()">
                    </div>
                </div>
            </div>
        </div>

        <div class="controls-block">
            <div class="team-controls">
                <h3>Équipe 2 - Contrôles</h3>
                <div class="control-group">
                    <label for="team2LogoInput">Logo :</label>
                    <input type="file" id="team2LogoInput" accept="image/*" onchange="changeLogo(2)">
                </div>
                <div class="control-group">
                    <label>Ajuster Logo :</label>
                    <div class="centered-content-group" style="flex-direction: column; gap: 5px;">
                        <div style="display: flex; gap: 5px;">
                            <button onclick="adjustLogo(2, 'up')"
                                style="font-size: 1.2em; padding: 4px 8px;">↑</button>
                            <button onclick="adjustLogo(2, 'left')"
                                style="font-size: 1.2em; padding: 4px 8px;">←</button>
                            <button onclick="adjustLogo(2, 'right')"
                                style="font-size: 1.2em; padding: 4px 8px;">→</button>
                            <button onclick="adjustLogo(2, 'down')"
                                style="font-size: 1.2em; padding: 4px 8px;">↓</button>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button onclick="adjustLogo(2, 'plus')"
                                style="font-size: 1.2em; padding: 4px 8px;">+</button>
                            <button onclick="adjustLogo(2, 'minus')"
                                style="font-size: 1.2em; padding: 4px 8px;">-</button>
                        </div>
                    </div>
                </div>
                <div class="control-group" style="display: flex; align-items: center; gap: 15px;"> <label
                        for="team2Name">Nom :</label>
                    <input type="text" id="team2Name" value="Équipe 2" maxlength="7" onchange="updateTeamName(2)"
                        style="flex-grow: 1; max-width: 80px; text-align: center;">
                    <div class="color-picker-wrapper" style="flex-shrink: 0;">
                        <label for="team2Color" style="display: none;">Couleur:</label> <input type="color"
                            id="team2Color" onchange="updateTeamColor(2)" value="#33a1ff"
                            style="width: 40px; height: 25px;">
                    </div>
                </div>
                <div class="control-group">
                    <label>Exclusions Temporaires :</label>
                    <div class="centered-content-group"> <button onclick="startExclusion(2)" data-shortcut="KeyO">+2
                            min</button>
                        <button class="remove-button-red" onclick="removeExclusion(2)" data-shortcut="KeyL">-2
                            min</button>
                    </div>
                </div>
                <div class="control-group">
                    <label>Temps Morts : <span id="team2TimeoutsControlDisplay"
                            style="font-weight: normal; color: #f0f0f0;">(0/3)</span></label>
                    <div class="centered-content-group"> <button onclick="addTimeout(2)"
                            data-shortcut="KeyI">+1</button>
                        <button class="remove-button-red" onclick="removeTimeout(2)" data-shortcut="KeyK">-1</button>
                    </div>
                </div>
                <div class="control-group">
                    <label>Score :</label>
                    <div class="centered-content-group"> <button class="score-button" onclick="updateScore(2, 1)"
                            data-shortcut="KeyP">+1</button>
                        <button class="score-button" onclick="updateScore(2, -1)" data-shortcut="KeyM">-1</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let timer;
        let time = 0;
        let isRunning = false;
        let pausedTime = 0;
        const gameDuration = 30 * 60; // 30 minutes

        let exclusionTimers = {
            team1: [],
            team2: [],
        };

        let timeouts = {
            team1: 0,
            team2: 0,
        };

        // NOUVEAU: Variables pour la position et la taille des logos
        let logoAdjustments = {
            team1: {
                x: -50, // Correspond au translate(-50%, -50%) initial
                y: -50,
                scale: 1 // Correspond au scale(1) initial
            },
            team2: {
                x: -50,
                y: -50,
                scale: 1
            }
        };


        const timerContainer = document.getElementById('timerContainer');
        const scoreboardElement = document.querySelector('.top-scoreboard-display'); // Référence au tableau de score

        // --- Fonctions de persistance des données ---
        function saveState() {
            const state = {
                time: time,
                isRunning: isRunning,
                pausedTime: pausedTime,
                team1Score: parseInt(document.getElementById('team1Score').textContent),
                team2Score: parseInt(document.getElementById('team2Score').textContent),
                team1Name: document.getElementById('team1Name').value,
                team2Name: document.getElementById('team2Name').value,
                team1Color: document.getElementById('team1Color').value,
                team2Color: document.getElementById('team2Color').value,
                halfTime: document.getElementById('halfTime').value,
                scoreColor: document.getElementById('scoreColor').value,
                timerColor: document.getElementById('timerColor').value,
                halfTimeColor: document.getElementById('halfTimeColor').value,
                timeouts: timeouts,
                exclusionTimers: {
                    team1: exclusionTimers.team1.map(e => ({
                        startTime: e.startTime,
                        duration: e.duration
                    })),
                    team2: exclusionTimers.team2.map(e => ({
                        startTime: e.startTime,
                        duration: e.duration
                    }))
                },
                // Récupérer l'attribut 'src' de l'image DANS le conteneur .logo
                team1Logo: document.getElementById('team1Logo').src,
                team2Logo: document.getElementById('team2Logo').src,
                isTransparentDisplay: document.getElementById('transparentDisplayToggle').checked, // État du toggle transparent
                scoreboardBgColor: document.getElementById('scoreboardBgColor').value, // NOUVEAU: couleur de fond du tableau
                logoAdjustments: logoAdjustments, // NOUVEAU: Sauvegarde les ajustements du logo
            };
            localStorage.setItem('handballScoreboardState', JSON.stringify(state));
        }

        function loadState() {
            const savedState = localStorage.getItem('handballScoreboardState');
            if (savedState) {
                const state = JSON.parse(savedState);

                time = state.time || 0;
                isRunning = state.isRunning || false;
                pausedTime = state.pausedTime || 0;

                document.getElementById('team1Score').textContent = state.team1Score || 0;
                document.getElementById('team2Score').textContent = state.team2Score || 0;

                document.getElementById('team1Name').value = state.team1Name || 'Équipe 1';
                document.getElementById('team1NameDisplay').textContent = (state.team1Name || 'Équipe 1').substring(0, 7).toUpperCase();
                document.getElementById('team2Name').value = state.team2Name || 'Équipe 2';
                document.getElementById('team2NameDisplay').textContent = (state.team2Name || 'Équipe 2').substring(0, 7).toUpperCase();

                document.getElementById('team1Color').value = state.team1Color || '#ff5733';
                document.getElementById('team2Color').value = state.team2Color || '#33a1ff';

                document.getElementById('halfTime').value = state.halfTime || 'first';
                document.getElementById('scoreColor').value = state.scoreColor || '#ffd700';
                document.getElementById('timerColor').value = state.timerColor || '#ff0000';
                document.getElementById('halfTimeColor').value = state.halfTimeColor || '#aaaaaa';

                timeouts = state.timeouts || {
                    team1: 0,
                    team2: 0
                };

                exclusionTimers = {
                    team1: [],
                    team2: []
                };
                if (state.exclusionTimers) {
                    ['team1', 'team2'].forEach(teamKey => {
                        if (state.exclusionTimers[teamKey]) {
                            state.exclusionTimers[teamKey].forEach(exclusionData => {
                                let exclusionElement = document.createElement("span");
                                exclusionElement.className = "exclusion-timer";
                                exclusionTimers[teamKey].push({
                                    id: exclusionData.id,
                                    startTime: exclusionData.startTime,
                                    duration: exclusionData.duration,
                                    element: exclusionElement,
                                    isRunning: exclusionData.isRunning
                                });
                            });
                        }
                    });
                }

                // Charger le src de l'image DANS le conteneur .logo
                if (state.team1Logo) {
                    document.getElementById('team1Logo').src = state.team1Logo;
                }
                if (state.team2Logo) {
                    document.getElementById('team2Logo').src = state.team2Logo;
                }

                // Charge et applique l'état du toggle transparent
                document.getElementById('transparentDisplayToggle').checked = state.isTransparentDisplay || false;

                // NOUVEAU: Charge et applique la couleur de fond du tableau
                document.getElementById('scoreboardBgColor').value = state.scoreboardBgColor || '#1E1E1E';

                // NOUVEAU: Charger et appliquer les ajustements du logo
                if (state.logoAdjustments) {
                    logoAdjustments = state.logoAdjustments;
                    document.documentElement.style.setProperty('--logo-pos-x-team1', `${logoAdjustments.team1.x}%`);
                    document.documentElement.style.setProperty('--logo-pos-y-team1', `${logoAdjustments.team1.y}%`);
                    document.documentElement.style.setProperty('--logo-scale-team1', logoAdjustments.team1.scale);
                    document.documentElement.style.setProperty('--logo-pos-x-team2', `${logoAdjustments.team2.x}%`);
                    document.documentElement.style.setProperty('--logo-pos-y-team2', `${logoAdjustments.team2.y}%`);
                    document.documentElement.style.setProperty('--logo-scale-team2', logoAdjustments.team2.scale);
                }

                updateDisplay();
                updateExclusions();
                updateTimeoutsControlDisplay(1);
                updateTimeoutsControlDisplay(2);
                updateHalfTimeDisplay();
                updateDisplayColors();
                toggleScoreboardStyle(); // Applique le style transparent ou non ET active/désactive le color picker
                updateScoreboardBackgroundColor(); // Applique la couleur de fond (si non transparent)
            }
        }
        // --- FIN Fonctions de persistance des données ---


        function startTimer() {
            if (!isRunning) {
                isRunning = true;
                if (pausedTime > 0) {
                    time = pausedTime;
                    pausedTime = 0;
                }
                timer = setInterval(updateTimer, 1000);
                timerContainer.classList.remove('timer-paused-active');
                saveState();
            }
        }

        function stopTimer() {
            if (isRunning) {
                clearInterval(timer);
                isRunning = false;
                pausedTime = time;
                timerContainer.classList.add('timer-paused-active');
                saveState();
            }
        }

        function confirmResetTimer() {
            if (confirm("Êtes-vous sûr de vouloir remettre le chrono à zéro ? Les scores ne seront pas affectés.")) {
                resetTimerOnly();
            }
        }

        function resetTimerOnly() {
            stopTimer();
            time = 0;
            pausedTime = 0;
            updateDisplay();
            resetExclusions();
            timeouts.team1 = 0;
            timeouts.team2 = 0;
            updateTimeoutsControlDisplay(1);
            updateTimeoutsControlDisplay(2);
            timerContainer.classList.remove('timer-paused-active');
            saveState();
        }


        function updateTimer() {
            time++;
            updateExclusions();
            updateDisplay();
            if (time >= gameDuration) {
                stopTimer();
            }
            saveState();
        }

        function adjustTimer(seconds) {
            time += seconds;
            if (time < 0) time = 0;
            if (time > gameDuration && isRunning) {
                time = gameDuration;
                stopTimer();
            }
            updateDisplay();
            saveState();
        }

        function updateDisplay() {
            let minutes = Math.floor(time / 60);
            let seconds = time % 60;
            document.getElementById('timer').textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function updateScore(team, points) {
            let scoreElement = document.getElementById(`team${team}Score`);
            let score = parseInt(scoreElement.textContent) + points;
            if (score < 0) score = 0;
            scoreElement.textContent = score;
            saveState();
        }

        function updateTeamName(team) {
            let teamNameInputElement = document.getElementById(`team${team}Name`);
            let teamNameDisplayElement = document.getElementById(`team${team}NameDisplay`);
            let rawName = teamNameInputElement.value.trim();

            if (rawName.length < 3 || rawName.length > 7) {
                alert("Le nom de l'équipe doit contenir entre 3 et 7 caractères.");
                return;
            }

            teamNameInputElement.value = rawName;
            teamNameDisplayElement.textContent = rawName.substring(0, 7).toUpperCase();

            saveState();
        }


        function updateTeamColor(team) {
            let colorInput = document.getElementById(`team${team}Color`);
            let teamNameDisplay = document.getElementById(`team${team}NameDisplay`);

            // Appliquer la couleur au texte du nom de l'équipe
            if (teamNameDisplay) {
                teamNameDisplay.style.color = colorInput.value;
                // Important: Mettre à jour la variable CSS pour la couleur du nom si elle était utilisée
                document.documentElement.style.setProperty(`--team${team}-name-color`, colorInput.value);
            }

            // Appliquer la couleur à la bordure latérale du conteneur de score
            const teamScoreContainer = document.querySelector(`.team-score-container.team${team}`);
            if (teamScoreContainer) {
                if (team === 1) {
                    teamScoreContainer.style.borderLeftColor = colorInput.value;
                    document.documentElement.style.setProperty(`--team1-color`, colorInput.value);
                } else if (team === 2) {
                    teamScoreContainer.style.borderRightColor = colorInput.value;
                    document.documentElement.style.setProperty(`--team2-color`, colorInput.value);
                }
            }

            // Le CSS utilise déjà les variables --teamX-color pour la bordure et l'ombre du logo.
            // Il suffit de s'assurer que ces variables sont mises à jour, ce qui est fait ci-dessus.
            // Aucun code JS supplémentaire n'est nécessaire ici pour le logo si les variables CSS sont bien mises à jour.
            // La suppression du code redondant ou potentiellement conflictuel est la meilleure approche.

            saveState();
        }

        function updateTimeoutsControlDisplay(team) {
            const displayElement = document.getElementById(`team${team}TimeoutsControlDisplay`);
            if (displayElement) {
                displayElement.textContent = `(${timeouts[`team${team}`]}/3)`;
            }
        }

        function addTimeout(team) {
            if (timeouts[`team${team}`] < 3) {
                timeouts[`team${team}`]++;
                updateTimeoutsControlDisplay(team);

                const teamName = document.getElementById(`team${team}NameDisplay`).textContent;
                const timeoutMessageContainer = document.getElementById(`team${team}ExclusionsContainer`);

                timeoutMessageContainer.innerHTML = '';
                const timeoutMessageElement = document.createElement("div");
                timeoutMessageElement.className = "timeout-message";
                timeoutMessageElement.textContent = `Temps Morts ${timeouts[`team${team}`]} - ${teamName}`;
                timeoutMessageContainer.appendChild(timeoutMessageElement);

                if (timeoutMessageContainer.dataset.timeoutTimer) {
                    clearTimeout(parseInt(timeoutMessageContainer.dataset.timeoutTimer));
                }

                const timeoutId = setTimeout(() => {
                    if (timeoutMessageElement.parentNode) {
                        timeoutMessageElement.remove();
                        updateExclusions();
                    }
                    delete timeoutMessageContainer.dataset.timeoutTimer;
                }, 30000);
                timeoutMessageContainer.dataset.timeoutTimer = timeoutId.toString();

                stopTimer();
                saveState();
            } else {
                alert(`L'équipe ${team} a déjà utilisé ses 3 temps morts.`);
            }
        }

        function removeTimeout(team) {
            if (timeouts[`team${team}`] > 0) {
                timeouts[`team${team}`]--;
                updateTimeoutsControlDisplay(team);

                const timeoutMessageContainer = document.getElementById(`team${team}ExclusionsContainer`);
                const existingTimeoutMessage = timeoutMessageContainer.querySelector('.timeout-message');
                if (existingTimeoutMessage) {
                    existingTimeoutMessage.remove();
                    if (timeoutMessageContainer.dataset.timeoutTimer) {
                        clearTimeout(parseInt(timeoutMessageContainer.dataset.timeoutTimer));
                        delete timeoutMessageContainer.dataset.timeoutTimer;
                    }
                    updateExclusions();
                }
                saveState();
            } else {
                alert(`Il n'y a pas de temps mort à retirer pour l'équipe ${team}.`);
            }
        }

        function changeLogo(team) {
            let input = document.getElementById(`team${team}LogoInput`);
            // Cible l'image DANS le conteneur .logo
            let logo = document.getElementById(`team${team}Logo`);
            if (input.files && input.files[0]) {
                let reader = new FileReader();
                reader.onload = function(e) {
                    logo.src = e.target.result;
                    saveState();
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // NOUVEAU: Fonction pour ajuster le logo (taille et position)
        function adjustLogo(team, direction) {
            const logoImg = document.getElementById(`team${team}Logo`);
            if (!logoImg) return;

            let {
                x,
                y,
                scale
            } = logoAdjustments[`team${team}`];
            const step = 0.1; // MODIFIÉ ICI : Pas d'ajustement en px pour le translate
            const scaleStep = 0.005; // MODIFIÉ ICI : Pas d'ajustement pour la taille

            switch (direction) {
                case 'up':
                    y -= step;
                    break;
                case 'down':
                    y += step;
                    break;
                case 'left':
                    x -= step;
                    break;
                case 'right':
                    x += step;
                    break;
                case 'plus':
                    scale += scaleStep;
                    break;
                case 'minus':
                    scale -= scaleStep;
                    if (scale < 0.005) scale = 0.005; // Limite minimale ajustée
                    break;
            }

            logoAdjustments[`team${team}`] = {
                x,
                y,
                scale
            };

            // Appliquer les styles via les variables CSS
            document.documentElement.style.setProperty(`--logo-pos-x-team${team}`, `${x}%`);
            document.documentElement.style.setProperty(`--logo-pos-y-team${team}`, `${y}%`);
            document.documentElement.style.setProperty(`--logo-scale-team${team}`, scale);

            saveState(); // Sauvegarder les nouvelles positions et tailles
        }


        function startExclusion(team) {
            if (exclusionTimers[`team${team}`].length >= 3) {
                alert(`L'équipe ${team} a déjà 3 exclusions temporaires actives.`);
                return;
            }

            const exclusionContainer = document.getElementById(`${team}ExclusionsContainer`);
            const timeoutMessage = exclusionContainer.querySelector('.timeout-message');
            if (timeoutMessage) {
                timeoutMessage.remove();
                if (exclusionContainer.dataset.timeoutTimer) {
                    clearTimeout(parseInt(exclusionContainer.dataset.timeoutTimer));
                    delete exclusionContainer.dataset.timeoutTimer;
                }
            }

            let exclusionTime = 120; // 2 minutes

            let exclusionElement = document.createElement("span");
            exclusionElement.className = "exclusion-timer";
            exclusionElement.textContent = formatTime(exclusionTime);

            exclusionContainer.appendChild(exclusionElement);


            exclusionTimers[`team${team}`].push({
                id: Date.now() + Math.random(),
                startTime: time,
                duration: exclusionTime,
                element: exclusionElement,
                isRunning: isRunning
            });
            saveState();
        }

        function removeExclusion(team) {
            if (exclusionTimers[`team${team}`].length > 0) {
                const lastExclusion = exclusionTimers[`team${team}`].pop();
                if (lastExclusion.element && lastExclusion.element.parentNode) {
                    lastExclusion.element.remove();
                }
                saveState();
            } else {
                alert(`Il n'y a pas d'exclusion à retirer pour l'équipe ${team}.`);
            }
        }

        function updateExclusions() {
            for (let teamKey in exclusionTimers) {
                const exclusionContainer = document.getElementById(`${teamKey}ExclusionsContainer`);
                if (!exclusionContainer.querySelector('.timeout-message')) {
                    exclusionContainer.innerHTML = '';
                } else {
                    continue;
                }

                exclusionTimers[teamKey] = exclusionTimers[teamKey].filter(exclusion => {
                    let elapsedTime = isRunning ? time - exclusion.startTime : pausedTime - exclusion.startTime;
                    let timeLeft = exclusion.duration - elapsedTime;

                    if (timeLeft <= 0) {
                        return false;
                    } else {
                        if (exclusion.element) {
                            exclusion.element.textContent = formatTime(timeLeft);
                            if (!exclusionContainer.contains(exclusion.element)) {
                                exclusionContainer.appendChild(exclusion.element);
                            }
                        }
                        return true;
                    }
                });
            }
            saveState();
        }


        function formatTime(seconds) {
            let minutes = Math.floor(seconds / 60);
            let remainingSeconds = seconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(remainingSeconds).padStart(2, '0')}`;
        }

        function updateHalfTimeDisplay() {
            const halfTimeSelect = document.getElementById('halfTime');
            const halfTimeDisplay = document.getElementById('halfTimeDisplay');
            const selectedValue = halfTimeSelect.value;

            if (selectedValue === 'first') {
                halfTimeDisplay.textContent = '1MT';
            } else if (selectedValue === 'second') {
                halfTimeDisplay.textContent = '2MT';
            }
            document.documentElement.style.setProperty('--half-time-color', document.getElementById('halfTimeColor').value);
            saveState();
        }

        function updateDisplayColors() {
            const scoreColor = document.getElementById('scoreColor').value;
            const timerColor = document.getElementById('timerColor').value;
            const halfTimeColor = document.getElementById('halfTimeColor').value;

            document.documentElement.style.setProperty('--score-color', scoreColor);
            document.documentElement.style.setProperty('--timer-color', timerColor);
            document.documentElement.style.setProperty('--half-time-color', halfTimeColor);
            saveState();
        }

        function toggleScoreboardStyle() {
            const transparentToggle = document.getElementById('transparentDisplayToggle');
            const scoreboardBgColorInput = document.getElementById('scoreboardBgColor');

            if (transparentToggle.checked) {
                scoreboardElement.classList.add('transparent-style');
                scoreboardBgColorInput.disabled = true;
            } else {
                scoreboardElement.classList.remove('transparent-style');
                scoreboardBgColorInput.disabled = false;
                updateScoreboardBackgroundColor();
            }
            saveState();
        }

        function updateScoreboardBackgroundColor() {
            const colorInput = document.getElementById('scoreboardBgColor');
            if (!document.getElementById('transparentDisplayToggle').checked) {
                const baseColor = colorInput.value;
                document.documentElement.style.setProperty('--scoreboard-bg-color-start', baseColor);

                const hexToRgb = hex => {
                    const r = parseInt(hex.slice(1, 3), 16);
                    const g = parseInt(hex.slice(3, 5), 16);
                    const b = parseInt(hex.slice(5, 7), 16);
                    return {
                        r,
                        g,
                        b
                    };
                };
                const rgbToHex = (r, g, b) => '#' + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);

                let {
                    r,
                    g,
                    b
                } = hexToRgb(baseColor);
                r = Math.max(0, r - 15);
                g = Math.max(0, g - 15);
                b = Math.max(0, b - 15);
                const darkerColor = rgbToHex(r, g, b);

                document.documentElement.style.setProperty('--scoreboard-bg-color-end', darkerColor);
            }
            saveState();
        }


        document.addEventListener('DOMContentLoaded', (event) => {
            loadState();
            // Appeler updateTeamColor pour les deux équipes pour s'assurer que les couleurs (et bordures de logo) sont appliquées au chargement
            updateTeamColor(1);
            updateTeamColor(2);
        });

        document.getElementById('halfTime').addEventListener('change', updateHalfTimeDisplay);


        // --- GESTION DES RACCOURCIS CLAVIER ---
        document.addEventListener('keydown', (event) => {
            if (event.code === 'Space' || event.code.startsWith('Digit') || event.code.startsWith('Numpad')) {
                event.preventDefault();
            }

            const keyPressed = event.code;
            const buttons = document.querySelectorAll('button[data-shortcut]');

            buttons.forEach(button => {
                if (button.dataset.shortcut === keyPressed) {
                    button.click();
                }
            });
        });
        // --- FIN GESTION DES RACCOURCIS CLAVIER ---
    </script>
</body>

</html>